{"version":3,"file":"index.js","sources":["../src/config/audiences.js","../src/config/defaults.js","../src/config/index.js","../src/facilities.js","../src/request.js","../node_modules/requires-port/index.js","../node_modules/querystringify/index.js","../node_modules/url-parse/index.js","../src/sessionTypes/auth0WebAuth.js","../src/index.js"],"sourcesContent":["export default {\n  contxtAuth: {\n    production: {\n      clientId: '75wT048QcpE7ujwBJPPjr263eTHl4gEX',\n      host: 'https://contxtauth.com'\n    },\n    staging: {\n      clientId: 'XzgumXUg5U57015haylz4zaJsiQqZy4l',\n      host: 'https://contxt-auth-staging.api.ndustrial.io'\n    }\n  },\n  facilities: {\n    production: {\n      clientId: 'SgbCopArnGMa9PsRlCVUCVRwxocntlg0',\n      host: 'https://facilities.api.ndustrial.io'\n    },\n    staging: {\n      clientId: 'xG775XHIOZVUn84seNeHXi0Qe55YuR5w',\n      host: 'https://facilities-staging.api.ndustrial.io'\n    }\n  }\n};\n","export default {\n  auth: {\n    authorizationPath: '/callback'\n  }\n};\n","import defaultAudiences from './audiences';\nimport defaultConfigs from './defaults';\n\nclass Config {\n  constructor(userConfig, externalModules) {\n    Object.assign(this, userConfig);\n\n    this.audiences = this._getAudiences({\n      externalModules,\n      customModuleConfigs: userConfig.customModuleConfigs,\n      env: userConfig.env\n    });\n\n    this.auth = {\n      ...defaultConfigs.auth,\n      ...userConfig.auth\n    };\n  }\n\n  _getAudienceFromCustomConfig(config, audiences) {\n    if (config.clientId && config.host) {\n      return {\n        clientId: config.clientId,\n        host: config.host\n      };\n    } else if (config.env) {\n      return audiences[config.env];\n    } else {\n      throw new Error('Custom module configurations must either contain a `host` and `clientId` or specify a specific target environment via the `env` property');\n    }\n  }\n\n  _getAudiences(options = {}) {\n    const {\n      customModuleConfigs = {},\n      env = 'production',\n      externalModules = {}\n    } = options;\n\n    return {\n      ...this._getInternalAudiences({\n        customModuleConfigs,\n        env,\n        audiences: defaultAudiences\n      }),\n      ...this._getExternalAudiences({ externalModules })\n    };\n  }\n\n  _getExternalAudiences({ externalModules }) {\n    return Object.keys(externalModules).reduce((memo, key) => {\n      if (!(externalModules[key].clientId && externalModules[key].host)) {\n        throw new Error('External modules must contain `clientId` and `host` properties');\n      }\n\n      memo[key] = {\n        clientId: externalModules[key].clientId,\n        host: externalModules[key].host\n      };\n\n      return memo;\n    }, {});\n  }\n\n  _getInternalAudiences({ audiences, customModuleConfigs, env }) {\n    return Object.keys(audiences).reduce((memo, key) => {\n      const customModuleConfig = customModuleConfigs[key];\n      const moduleAudiences = audiences[key];\n\n      if (customModuleConfig) {\n        memo[key] = this._getAudienceFromCustomConfig(customModuleConfig, moduleAudiences);\n      } else {\n        memo[key] = moduleAudiences[env];\n      }\n\n      return memo;\n    }, {});\n  }\n}\n\nexport default Config;\n","class Facilities {\n  constructor(sdk, request) {\n    this._baseUrl = `${sdk.config.audiences.facilities.host}/v1`;\n    this._request = request;\n    this._sdk = sdk;\n  }\n\n  get(facilityId) {\n    return this._request.get(`${this._baseUrl}/facilities/${facilityId}`);\n  }\n\n  getAll() {\n    return this._request.get(`${this._baseUrl}/facilities`);\n  }\n}\n\nexport default Facilities;\n","import axios from 'axios';\n\nclass Request {\n  constructor(sdk, audienceName) {\n    this._audienceName = audienceName;\n    this._sdk = sdk;\n    this._axios = axios.create();\n\n    this._axios.interceptors.request.use(this._insertHeaders);\n  }\n\n  delete(...args) {\n    return this._axios.delete(...args)\n      .then(({ data }) => data);\n  }\n\n  get(...args) {\n    return this._axios.get(...args)\n      .then(({ data }) => data);\n  }\n\n  head(...args) {\n    return this._axios.head(...args)\n      .then(({ data }) => data);\n  }\n\n  options(...args) {\n    return this._axios.options(...args)\n      .then(({ data }) => data);\n  }\n\n  patch(...args) {\n    return this._axios.patch(...args)\n      .then(({ data }) => data);\n  }\n\n  post(...args) {\n    return this._axios.post(...args)\n      .then(({ data }) => data);\n  }\n\n  put(...args) {\n    return this._axios.put(...args)\n      .then(({ data }) => data);\n  }\n\n  request(...args) {\n    return this._axios.request(...args)\n      .then(({ data }) => data);\n  }\n\n  _insertHeaders = (config) => {\n    config.headers.common.Authorization = `Bearer ${this._sdk.auth.getCurrentApiToken(this._audienceName)}`;\n\n    return config;\n  }\n}\n\nexport default Request;\n","'use strict';\n\n/**\n * Check if we're required to add a port number.\n *\n * @see https://url.spec.whatwg.org/#default-port\n * @param {Number|String} port Port number we need to check\n * @param {String} protocol Protocol we need to check against.\n * @returns {Boolean} Is it a default port for the given protocol\n * @api private\n */\nmodule.exports = function required(port, protocol) {\n  protocol = protocol.split(':')[0];\n  port = +port;\n\n  if (!port) return false;\n\n  switch (protocol) {\n    case 'http':\n    case 'ws':\n    return port !== 80;\n\n    case 'https':\n    case 'wss':\n    return port !== 443;\n\n    case 'ftp':\n    return port !== 21;\n\n    case 'gopher':\n    return port !== 70;\n\n    case 'file':\n    return false;\n  }\n\n  return port !== 0;\n};\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty;\n\n/**\n * Decode a URI encoded string.\n *\n * @param {String} input The URI encoded string.\n * @returns {String} The decoded string.\n * @api private\n */\nfunction decode(input) {\n  return decodeURIComponent(input.replace(/\\+/g, ' '));\n}\n\n/**\n * Simple query string parser.\n *\n * @param {String} query The query string that needs to be parsed.\n * @returns {Object}\n * @api public\n */\nfunction querystring(query) {\n  var parser = /([^=?&]+)=?([^&]*)/g\n    , result = {}\n    , part;\n\n  //\n  // Little nifty parsing hack, leverage the fact that RegExp.exec increments\n  // the lastIndex property so we can continue executing this loop until we've\n  // parsed all results.\n  //\n  for (;\n    part = parser.exec(query);\n    result[decode(part[1])] = decode(part[2])\n  );\n\n  return result;\n}\n\n/**\n * Transform a query string to an object.\n *\n * @param {Object} obj Object that should be transformed.\n * @param {String} prefix Optional prefix.\n * @returns {String}\n * @api public\n */\nfunction querystringify(obj, prefix) {\n  prefix = prefix || '';\n\n  var pairs = [];\n\n  //\n  // Optionally prefix with a '?' if needed\n  //\n  if ('string' !== typeof prefix) prefix = '?';\n\n  for (var key in obj) {\n    if (has.call(obj, key)) {\n      pairs.push(encodeURIComponent(key) +'='+ encodeURIComponent(obj[key]));\n    }\n  }\n\n  return pairs.length ? prefix + pairs.join('&') : '';\n}\n\n//\n// Expose the module.\n//\nexports.stringify = querystringify;\nexports.parse = querystring;\n","'use strict';\n\nvar required = require('requires-port')\n  , qs = require('querystringify')\n  , protocolre = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\S\\s]*)/i\n  , slashes = /^[A-Za-z][A-Za-z0-9+-.]*:\\/\\//;\n\n/**\n * These are the parse rules for the URL parser, it informs the parser\n * about:\n *\n * 0. The char it Needs to parse, if it's a string it should be done using\n *    indexOf, RegExp using exec and NaN means set as current value.\n * 1. The property we should set when parsing this value.\n * 2. Indication if it's backwards or forward parsing, when set as number it's\n *    the value of extra chars that should be split off.\n * 3. Inherit from location if non existing in the parser.\n * 4. `toLowerCase` the resulting value.\n */\nvar rules = [\n  ['#', 'hash'],                        // Extract from the back.\n  ['?', 'query'],                       // Extract from the back.\n  ['/', 'pathname'],                    // Extract from the back.\n  ['@', 'auth', 1],                     // Extract from the front.\n  [NaN, 'host', undefined, 1, 1],       // Set left over value.\n  [/:(\\d+)$/, 'port', undefined, 1],    // RegExp the back.\n  [NaN, 'hostname', undefined, 1, 1]    // Set left over.\n];\n\n/**\n * These properties should not be copied or inherited from. This is only needed\n * for all non blob URL's as a blob URL does not include a hash, only the\n * origin.\n *\n * @type {Object}\n * @private\n */\nvar ignore = { hash: 1, query: 1 };\n\n/**\n * The location object differs when your code is loaded through a normal page,\n * Worker or through a worker using a blob. And with the blobble begins the\n * trouble as the location object will contain the URL of the blob, not the\n * location of the page where our code is loaded in. The actual origin is\n * encoded in the `pathname` so we can thankfully generate a good \"default\"\n * location from it so we can generate proper relative URL's again.\n *\n * @param {Object|String} loc Optional default location object.\n * @returns {Object} lolcation object.\n * @api public\n */\nfunction lolcation(loc) {\n  loc = loc || global.location || {};\n\n  var finaldestination = {}\n    , type = typeof loc\n    , key;\n\n  if ('blob:' === loc.protocol) {\n    finaldestination = new URL(unescape(loc.pathname), {});\n  } else if ('string' === type) {\n    finaldestination = new URL(loc, {});\n    for (key in ignore) delete finaldestination[key];\n  } else if ('object' === type) {\n    for (key in loc) {\n      if (key in ignore) continue;\n      finaldestination[key] = loc[key];\n    }\n\n    if (finaldestination.slashes === undefined) {\n      finaldestination.slashes = slashes.test(loc.href);\n    }\n  }\n\n  return finaldestination;\n}\n\n/**\n * @typedef ProtocolExtract\n * @type Object\n * @property {String} protocol Protocol matched in the URL, in lowercase.\n * @property {Boolean} slashes `true` if protocol is followed by \"//\", else `false`.\n * @property {String} rest Rest of the URL that is not part of the protocol.\n */\n\n/**\n * Extract protocol information from a URL with/without double slash (\"//\").\n *\n * @param {String} address URL we want to extract from.\n * @return {ProtocolExtract} Extracted information.\n * @api private\n */\nfunction extractProtocol(address) {\n  var match = protocolre.exec(address);\n\n  return {\n    protocol: match[1] ? match[1].toLowerCase() : '',\n    slashes: !!match[2],\n    rest: match[3]\n  };\n}\n\n/**\n * Resolve a relative URL pathname against a base URL pathname.\n *\n * @param {String} relative Pathname of the relative URL.\n * @param {String} base Pathname of the base URL.\n * @return {String} Resolved pathname.\n * @api private\n */\nfunction resolve(relative, base) {\n  var path = (base || '/').split('/').slice(0, -1).concat(relative.split('/'))\n    , i = path.length\n    , last = path[i - 1]\n    , unshift = false\n    , up = 0;\n\n  while (i--) {\n    if (path[i] === '.') {\n      path.splice(i, 1);\n    } else if (path[i] === '..') {\n      path.splice(i, 1);\n      up++;\n    } else if (up) {\n      if (i === 0) unshift = true;\n      path.splice(i, 1);\n      up--;\n    }\n  }\n\n  if (unshift) path.unshift('');\n  if (last === '.' || last === '..') path.push('');\n\n  return path.join('/');\n}\n\n/**\n * The actual URL instance. Instead of returning an object we've opted-in to\n * create an actual constructor as it's much more memory efficient and\n * faster and it pleases my OCD.\n *\n * @constructor\n * @param {String} address URL we want to parse.\n * @param {Object|String} location Location defaults for relative paths.\n * @param {Boolean|Function} parser Parser for the query string.\n * @api public\n */\nfunction URL(address, location, parser) {\n  if (!(this instanceof URL)) {\n    return new URL(address, location, parser);\n  }\n\n  var relative, extracted, parse, instruction, index, key\n    , instructions = rules.slice()\n    , type = typeof location\n    , url = this\n    , i = 0;\n\n  //\n  // The following if statements allows this module two have compatibility with\n  // 2 different API:\n  //\n  // 1. Node.js's `url.parse` api which accepts a URL, boolean as arguments\n  //    where the boolean indicates that the query string should also be parsed.\n  //\n  // 2. The `URL` interface of the browser which accepts a URL, object as\n  //    arguments. The supplied object will be used as default values / fall-back\n  //    for relative paths.\n  //\n  if ('object' !== type && 'string' !== type) {\n    parser = location;\n    location = null;\n  }\n\n  if (parser && 'function' !== typeof parser) parser = qs.parse;\n\n  location = lolcation(location);\n\n  //\n  // Extract protocol information before running the instructions.\n  //\n  extracted = extractProtocol(address || '');\n  relative = !extracted.protocol && !extracted.slashes;\n  url.slashes = extracted.slashes || relative && location.slashes;\n  url.protocol = extracted.protocol || location.protocol || '';\n  address = extracted.rest;\n\n  //\n  // When the authority component is absent the URL starts with a path\n  // component.\n  //\n  if (!extracted.slashes) instructions[2] = [/(.*)/, 'pathname'];\n\n  for (; i < instructions.length; i++) {\n    instruction = instructions[i];\n    parse = instruction[0];\n    key = instruction[1];\n\n    if (parse !== parse) {\n      url[key] = address;\n    } else if ('string' === typeof parse) {\n      if (~(index = address.indexOf(parse))) {\n        if ('number' === typeof instruction[2]) {\n          url[key] = address.slice(0, index);\n          address = address.slice(index + instruction[2]);\n        } else {\n          url[key] = address.slice(index);\n          address = address.slice(0, index);\n        }\n      }\n    } else if ((index = parse.exec(address))) {\n      url[key] = index[1];\n      address = address.slice(0, index.index);\n    }\n\n    url[key] = url[key] || (\n      relative && instruction[3] ? location[key] || '' : ''\n    );\n\n    //\n    // Hostname, host and protocol should be lowercased so they can be used to\n    // create a proper `origin`.\n    //\n    if (instruction[4]) url[key] = url[key].toLowerCase();\n  }\n\n  //\n  // Also parse the supplied query string in to an object. If we're supplied\n  // with a custom parser as function use that instead of the default build-in\n  // parser.\n  //\n  if (parser) url.query = parser(url.query);\n\n  //\n  // If the URL is relative, resolve the pathname against the base URL.\n  //\n  if (\n      relative\n    && location.slashes\n    && url.pathname.charAt(0) !== '/'\n    && (url.pathname !== '' || location.pathname !== '')\n  ) {\n    url.pathname = resolve(url.pathname, location.pathname);\n  }\n\n  //\n  // We should not add port numbers if they are already the default port number\n  // for a given protocol. As the host also contains the port number we're going\n  // override it with the hostname which contains no port number.\n  //\n  if (!required(url.port, url.protocol)) {\n    url.host = url.hostname;\n    url.port = '';\n  }\n\n  //\n  // Parse down the `auth` for the username and password.\n  //\n  url.username = url.password = '';\n  if (url.auth) {\n    instruction = url.auth.split(':');\n    url.username = instruction[0] || '';\n    url.password = instruction[1] || '';\n  }\n\n  url.origin = url.protocol && url.host && url.protocol !== 'file:'\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  //\n  // The href is just the compiled result.\n  //\n  url.href = url.toString();\n}\n\n/**\n * This is convenience method for changing properties in the URL instance to\n * insure that they all propagate correctly.\n *\n * @param {String} part          Property we need to adjust.\n * @param {Mixed} value          The newly assigned value.\n * @param {Boolean|Function} fn  When setting the query, it will be the function\n *                               used to parse the query.\n *                               When setting the protocol, double slash will be\n *                               removed from the final url if it is true.\n * @returns {URL}\n * @api public\n */\nfunction set(part, value, fn) {\n  var url = this;\n\n  switch (part) {\n    case 'query':\n      if ('string' === typeof value && value.length) {\n        value = (fn || qs.parse)(value);\n      }\n\n      url[part] = value;\n      break;\n\n    case 'port':\n      url[part] = value;\n\n      if (!required(value, url.protocol)) {\n        url.host = url.hostname;\n        url[part] = '';\n      } else if (value) {\n        url.host = url.hostname +':'+ value;\n      }\n\n      break;\n\n    case 'hostname':\n      url[part] = value;\n\n      if (url.port) value += ':'+ url.port;\n      url.host = value;\n      break;\n\n    case 'host':\n      url[part] = value;\n\n      if (/:\\d+$/.test(value)) {\n        value = value.split(':');\n        url.port = value.pop();\n        url.hostname = value.join(':');\n      } else {\n        url.hostname = value;\n        url.port = '';\n      }\n\n      break;\n\n    case 'protocol':\n      url.protocol = value.toLowerCase();\n      url.slashes = !fn;\n      break;\n\n    case 'pathname':\n    case 'hash':\n      if (value) {\n        var char = part === 'pathname' ? '/' : '#';\n        url[part] = value.charAt(0) !== char ? char + value : value;\n      } else {\n        url[part] = value;\n      }\n      break;\n\n    default:\n      url[part] = value;\n  }\n\n  for (var i = 0; i < rules.length; i++) {\n    var ins = rules[i];\n\n    if (ins[4]) url[ins[1]] = url[ins[1]].toLowerCase();\n  }\n\n  url.origin = url.protocol && url.host && url.protocol !== 'file:'\n    ? url.protocol +'//'+ url.host\n    : 'null';\n\n  url.href = url.toString();\n\n  return url;\n}\n\n/**\n * Transform the properties back in to a valid and full URL string.\n *\n * @param {Function} stringify Optional query stringify function.\n * @returns {String}\n * @api public\n */\nfunction toString(stringify) {\n  if (!stringify || 'function' !== typeof stringify) stringify = qs.stringify;\n\n  var query\n    , url = this\n    , protocol = url.protocol;\n\n  if (protocol && protocol.charAt(protocol.length - 1) !== ':') protocol += ':';\n\n  var result = protocol + (url.slashes ? '//' : '');\n\n  if (url.username) {\n    result += url.username;\n    if (url.password) result += ':'+ url.password;\n    result += '@';\n  }\n\n  result += url.host + url.pathname;\n\n  query = 'object' === typeof url.query ? stringify(url.query) : url.query;\n  if (query) result += '?' !== query.charAt(0) ? '?'+ query : query;\n\n  if (url.hash) result += url.hash;\n\n  return result;\n}\n\nURL.prototype = { set: set, toString: toString };\n\n//\n// Expose the URL parser and some additional properties that might be useful for\n// others or testing.\n//\nURL.extractProtocol = extractProtocol;\nURL.location = lolcation;\nURL.qs = qs;\n\nmodule.exports = URL;\n","import auth0 from 'auth0-js';\nimport axios from 'axios';\nimport URL from 'url-parse';\n\nclass Auth0WebAuth {\n  constructor(sdk) {\n    this._sdk = sdk;\n\n    if (!this._sdk.config.auth.clientId) {\n      throw new Error('clientId is required for the WebAuth config');\n    }\n\n    this._onRedirect = this._sdk.config.auth.onRedirect || this._defaultOnRedirect;\n    this._sessionInfo = this._loadSession();\n\n    const currentUrl = new URL(window.location);\n    currentUrl.set('pathname', this._sdk.config.auth.authorizationPath);\n\n    this._auth0 = new auth0.WebAuth({\n      audience: this._sdk.config.audiences.contxtAuth.clientId,\n      clientID: this._sdk.config.auth.clientId,\n      domain: 'ndustrial.auth0.com',\n      redirectUri: `${currentUrl.origin}${currentUrl.pathname}`,\n      responseType: 'token',\n      scope: 'profile openid'\n    });\n  }\n\n  getCurrentAccessToken() {\n    return this._getCurrentTokenByType('access');\n  }\n\n  getCurrentApiToken() {\n    return this._getCurrentTokenByType('api');\n  }\n\n  getProfile() {\n    return new Promise((resolve, reject) => {\n      this._auth0.client.userInfo(this.getCurrentAccessToken(), (err, profile) => {\n        if (err) {\n          reject(err);\n        }\n\n        resolve(profile);\n      });\n    });\n  }\n\n  handleAuthentication() {\n    return this._parseWebAuthHash()\n      .then((hash) => {\n        return Promise.all([\n          {\n            accessToken: hash.accessToken,\n            expiresAt: (hash.expiresIn * 1000) + Date.now()\n          },\n          this._getApiToken(hash.accessToken)\n        ]);\n      })\n      .then(([partialSessionInfo, apiToken]) => {\n        const sessionInfo = {\n          ...partialSessionInfo,\n          apiToken\n        };\n\n        this._saveSession(sessionInfo);\n\n        return sessionInfo;\n      })\n      .then((sessionInfo) => {\n        const redirectPathname = this._getRedirectPathname();\n\n        this._onRedirect(redirectPathname);\n\n        return sessionInfo;\n      })\n      .catch((err) => {\n        console.log(`Error while handling authentication: ${err}`);\n\n        this._onRedirect('/');\n\n        throw err;\n      });\n  }\n\n  isAuthenticated() {\n    const hasTokens = !!(this._sessionInfo && this._sessionInfo.accessToken &&\n      this._sessionInfo.apiToken && this._sessionInfo.expiresAt);\n\n    return hasTokens && this._sessionInfo.expiresAt > Date.now();\n  }\n\n  logIn() {\n    this._auth0.authorize();\n  }\n\n  logOut() {\n    this._sessionInfo = {};\n\n    localStorage.removeItem('access_token');\n    localStorage.removeItem('api_token');\n    localStorage.removeItem('expires_at');\n\n    this._onRedirect('/');\n  }\n\n  _defaultOnRedirect(pathname) {\n    window.location = pathname;\n  }\n\n  _getApiToken(accessToken) {\n    return axios\n      .post(\n        `${this._sdk.config.audiences.contxtAuth.host}/v1/token`,\n        {\n          audiences: Object.keys(this._sdk.config.audiences)\n            .map((audienceName) => this._sdk.config.audiences[audienceName].clientId)\n            .filter((clientId) => clientId !== this._sdk.config.audiences.contxtAuth.clientId),\n          nonce: 'nonce'\n        },\n        {\n          headers: { Authorization: `Bearer ${accessToken}` }\n        }\n      )\n      .then(({ data }) => data.access_token);\n  }\n\n  _getCurrentTokenByType(type) {\n    const propertyName = `${type}Token`;\n\n    if (!(this._sessionInfo && this._sessionInfo[propertyName])) {\n      throw new Error(`No ${type} token found`);\n    }\n\n    return this._sessionInfo[propertyName];\n  }\n\n  _getRedirectPathname() {\n    const redirectPathname = localStorage.getItem('redirect_pathname');\n    localStorage.removeItem('redirect_pathname');\n\n    return redirectPathname || '/';\n  }\n\n  _loadSession() {\n    return {\n      accessToken: localStorage.getItem('access_token'),\n      apiToken: localStorage.getItem('api_token'),\n      expiresAt: localStorage.getItem('expires_at')\n    };\n  }\n\n  _parseWebAuthHash() {\n    return new Promise((resolve, reject) => {\n      this._auth0.parseHash((err, hashResponse) => {\n        if (err || !hashResponse) {\n          return reject(err || new Error('No valid tokens returned from auth0'));\n        }\n\n        return resolve(hashResponse);\n      });\n    });\n  }\n\n  _saveSession(sessionInfo) {\n    this._sessionInfo = sessionInfo;\n\n    localStorage.setItem('access_token', sessionInfo.accessToken);\n    localStorage.setItem('api_token', sessionInfo.apiToken);\n    localStorage.setItem('expires_at', sessionInfo.expiresAt);\n  }\n}\n\nexport default Auth0WebAuth;\n","import Config from './config';\nimport Facilities from './facilities';\nimport Request from './request';\nimport * as sessionTypes from './sessionTypes';\n\nclass ContxtSdk {\n  constructor({ config = {}, externalModules = {}, sessionType }) {\n    this.config = new Config(config, externalModules);\n\n    this.auth = this._createAuthSession(sessionType);\n    this.facilities = new Facilities(this, this._createRequest('facilities'));\n\n    this._decorate(externalModules);\n  }\n\n  _createAuthSession(sessionType) {\n    switch (sessionType) {\n      case 'auth0WebAuth':\n        return new sessionTypes.Auth0WebAuth(this);\n\n      default:\n        throw new Error('Invalid sessionType provided');\n    }\n  }\n\n  _createRequest(audienceName) {\n    return new Request(this, audienceName);\n  }\n\n  _decorate(modules) {\n    Object.keys(modules).forEach((moduleName) => {\n      this[moduleName] = new modules[moduleName].module(this, this._createRequest(moduleName));\n    });\n  }\n}\n\nexport default ContxtSdk;\n"],"names":["Config","userConfig","externalModules","assign","audiences","_getAudiences","customModuleConfigs","env","auth","defaultConfigs","config","clientId","host","Error","options","_getInternalAudiences","defaultAudiences","_getExternalAudiences","Object","keys","reduce","memo","key","customModuleConfig","moduleAudiences","_getAudienceFromCustomConfig","Facilities","sdk","request","_baseUrl","facilities","_request","_sdk","facilityId","get","Request","audienceName","_insertHeaders","headers","common","Authorization","getCurrentApiToken","_audienceName","_axios","axios","create","interceptors","use","delete","then","data","head","patch","post","put","global","qs","required","set","Auth0WebAuth","_onRedirect","onRedirect","_defaultOnRedirect","_sessionInfo","_loadSession","currentUrl","URL","window","location","authorizationPath","_auth0","auth0","WebAuth","contxtAuth","origin","pathname","_getCurrentTokenByType","Promise","resolve","reject","client","userInfo","getCurrentAccessToken","err","profile","_parseWebAuthHash","hash","all","accessToken","expiresIn","Date","now","_getApiToken","partialSessionInfo","apiToken","sessionInfo","_saveSession","redirectPathname","_getRedirectPathname","catch","log","hasTokens","expiresAt","authorize","removeItem","map","filter","access_token","type","propertyName","localStorage","getItem","parseHash","hashResponse","setItem","ContxtSdk","sessionType","_createAuthSession","_createRequest","_decorate","sessionTypes","modules","forEach","moduleName","module"],"mappings":"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"}